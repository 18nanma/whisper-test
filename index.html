<!doctype html><html lang="en"><head><meta charset="utf-8"/><link rel="icon" href="/whisper-test/favicon.ico"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#000000"/><meta name="description" content="ScribeAR - an accessibility app by the University of Illinois Urbana-Champaign"/><meta http-equiv="origin-trial" content="AvwoDBEybY9cD61RRP3B1Ht0d3pjUQ1NsVUVovw/kix7fuJALxMOG/aoQxeTAjkwnxi+BNCWMwwe/hENKhM/aQMAAAB7eyJvcmlnaW4iOiJodHRwczovLzE4bmFubWEuZ2l0aHViLmlvOjQ0MyIsImZlYXR1cmUiOiJVbnJlc3RyaWN0ZWRTaGFyZWRBcnJheUJ1ZmZlciIsImV4cGlyeSI6MTY4ODA4MzE5OSwiaXNTdWJkb21haW4iOnRydWV9"><link rel="apple-touch-icon" href="/whisper-test/logo192.png"/><link rel="manifest" href="/whisper-test/manifest.json"/><script src="helpers.js" type="text/jsx"></script><title>ScribeAR</title><script defer="defer" src="/whisper-test/static/js/main.8f9a8bef.js"></script><link href="/whisper-test/static/css/main.073c9b0a.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="input" style="z-index:100000"><button id="start" onclick="onStart()" disabled="disabled" style="z-index:100000;margin-top:20%">Start</button> <button id="stop" onclick="onStop()" disabled="disabled" style="z-index:100000;margin-top:20%">Stop</button> <button id="clear" onclick="clearCache()" style="z-index:100000">Clear Cache</button></div><button id="fetch-whisper-tiny-en" onclick='loadWhisper("tiny.en")' style="z-index:10000;margin-top:20%">tiny.en (75 MB)</button><div id="root"></div><script type="text/javascript">var context=null,audio=null,audio0=null,instance=null,model_whisper=null,Module={setStatus:function(e){console.log("js: "+e)},monitorRunDependencies:function(e){},preRun:function(){console.log("js: Preparing ...")},postRun:function(){console.log("js: Initialized successfully!")}};let dbVersion=1,dbName="whisper.ggerganov.com",indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;function storeFS(e,n){try{Module.FS_unlink(e)}catch(e){}Module.FS_createDataFile("/",e,n,!0,!0),console.log("storeFS: stored model: "+e+" size: "+n.length),console.log('model-whisper-status loaded "'+model_whisper+'"!'),null!=model_whisper&&(document.getElementById("start").disabled=!1,document.getElementById("stop").disabled=!0)}function loadWhisper(e){alert("clicked");let n={"tiny.en":"https://angrave.web.engr.illinois.edu/scribear/data/ggml-model-whisper-tiny.en.bin","base.en":"https://whisper.ggerganov.com/ggml-model-whisper-base.en.bin"}[e],t={"tiny.en":75,"base.en":142}[e];model_whisper=e,document.getElementById("fetch-whisper-tiny-en").style.display="none",cbProgress=function(e){console.log(Math.round(100*e)+"%")},cbCancel=function(){var e;(e=document.getElementById("fetch-whisper-tiny-en"))&&(e.style.display="inline-block")},window.loadRemote(n,"whisper.bin",t,cbProgress,storeFS,cbCancel,printTextarea)}const kSampleRate=16e3,kRestartRecording_s=120,kIntervalAudio_ms=3e3;var mediaRecorder=null,doRecording=!1,startTime=0;function stopRecording(){Module.set_status("paused"),doRecording=!1,audio0=null,audio=null,context=null}function startRecording(){context||(context=new AudioContext({sampleRate:kSampleRate,channelCount:1,echoCancellation:!1,autoGainControl:!0,noiseSuppression:!0})),Module.set_status(""),document.getElementById("start").disabled=!0,document.getElementById("stop").disabled=!1,doRecording=!0,startTime=Date.now();var e=[],n=null;navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){n=t,(mediaRecorder=new MediaRecorder(n)).ondataavailable=function(n){e.push(n.data);var t=new Blob(e,{type:"audio/ogg; codecs=opus"}),o=new FileReader;o.onload=function(e){var n=new Uint8Array(o.result);context&&context.decodeAudioData(n.buffer,(function(e){var n=new OfflineAudioContext(e.numberOfChannels,e.length,e.sampleRate),t=n.createBufferSource();t.buffer=e,t.connect(n.destination),t.start(0),n.startRendering().then((function(e){audio=e.getChannelData(0);var n=new Float32Array(null==audio0?audio.length:audio0.length+audio.length);null!=audio0&&n.set(audio0,0),n.set(audio,null==audio0?0:audio0.length),instance&&Module.set_audio(instance,n)}))}),(function(e){audio=null}))},o.readAsArrayBuffer(t)},mediaRecorder.onstop=function(e){doRecording&&setTimeout((function(){startRecording()}))},mediaRecorder.start(kIntervalAudio_ms)})).catch((function(e){console.log("js: error getting audio stream: "+e)}));var t=setInterval((function(){doRecording||(clearInterval(t),mediaRecorder.stop(),n.getTracks().forEach((function(e){e.stop()})),document.getElementById("start").disabled=!1,document.getElementById("stop").disabled=!0,mediaRecorder=null),null!=audio&&audio.length>kSampleRate*kRestartRecording_s&&doRecording&&(clearInterval(t),audio0=audio,audio=null,mediaRecorder.stop(),n.getTracks().forEach((function(e){e.stop()})))}),100)}window.AudioContext=window.AudioContext||window.webkitAudioContext,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext;var nLines=0,intervalUpdate=null,transcribedAll="";function onStart(){instance||(instance=Module.init("whisper.bin"))&&console.log("js: whisper initialized, instance: "+instance),instance?(startRecording(),intervalUpdate=setInterval((function(){var e=Module.get_transcribed();if(null!=e&&e.length>1&&(transcribedAll+=e+"<br>",++nLines>10)){var n=transcribedAll.indexOf("<br>");n>0&&(transcribedAll=transcribedAll.substring(n+4),nLines--)}}),100)):console.log("js: failed to initialize whisper")}function onStop(){stopRecording()}</script><script src="stream.js" type="text/jsx"></script><script src="libstream.worker.js" type="text/jsx"></script></body></html>